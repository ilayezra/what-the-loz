<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ?</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }

        textarea {
            width: 100%;
            height: 300px;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #404040;
            border-radius: 8px;
            font-size: 16px;
            direction: rtl;
            background: #2d2d2d;
            color: #ffffff;
        }

        button {
            background: #0A84FF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background: #0062cc;
        }

        .instructions {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        #preview {
            margin-top: 20px;
        }

        .event {
            background: #2d2d2d;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-right: 4px solid #0A84FF;
        }

        .footer {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        text-align: center;
        font-size: 12px;
        }
        
    </style>
</head>
<body>
    <div class="instructions">
        <h2> "? -  锔</h2>
        <p>住 转 专注 砖 -  专注 砖专 砖 驻专 :</p>
        <p>砖注 砖 专注</p>
    </div>
    
    <textarea id="eventInput" placeholder="住 转 专注 , :
8:30 拽驻 砖 拽专
9:00 驻砖转 爪转
10:30 转专"></textarea>
    
    <button onclick="parseEvents()">爪专 专注</button>
    
    <div id="preview"></div>

    <div class="footer">
        <p>爪专 わ 驻转 住驻</p>
    </div>
    <script>
        function parseEvents() {
            const input = document.getElementById('eventInput').value;
            const lines = input.split('\n').filter(line => line.trim());
            const events = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const timeMatch = line.match(/^(\d{1,2}:\d{2})/);
                
                if (timeMatch) {
                    const time = timeMatch[1];
                    const title = line.substring(timeMatch[0].length).trim();
                    
                    let endTime;
                    if (i < lines.length - 1) {
                        const nextTimeMatch = lines[i + 1].match(/^(\d{1,2}:\d{2})/);
                        endTime = nextTimeMatch ? nextTimeMatch[1] : addHour(time);
                    } else {
                        endTime = addHour(time);
                    }
                    
                    events.push({ title, startTime: time, endTime });
                }
            }
            
            displayEvents(events);
            createCombinedCalendarEvents(events);
        }
        
        function addHour(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const date = new Date(2024, 0, 1, hours, minutes);
            date.setHours(date.getHours() + 1);
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }
        
        function displayEvents(events) {
            const preview = document.getElementById('preview');
            preview.innerHTML = '<h3>专注 砖爪专:</h3>';
            
            events.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event';
                eventDiv.textContent = `${event.startTime} - ${event.endTime}: ${event.title}`;
                preview.appendChild(eventDiv);
            });
        }
        
        function createCombinedCalendarEvents(events) {
            const today = new Date();
            let calendarContent = 'BEGIN:VCALENDAR\nVERSION:2.0\n';
            
            events.forEach(event => {
                const [startHours, startMinutes] = event.startTime.split(':').map(Number);
                const [endHours, endMinutes] = event.endTime.split(':').map(Number);
                
                const startDate = new Date(today);
                startDate.setHours(startHours, startMinutes, 0);
                
                const endDate = new Date(today);
                endDate.setHours(endHours, endMinutes, 0);
                
                calendarContent += 'BEGIN:VEVENT\n';
                calendarContent += `DTSTART:${formatDate(startDate)}\n`;
                calendarContent += `DTEND:${formatDate(endDate)}\n`;
                calendarContent += `SUMMARY:${event.title}\n`;
                calendarContent += 'END:VEVENT\n';
            });
            
            calendarContent += 'END:VCALENDAR';
            
            const blob = new Blob([calendarContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = '.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
        
        function formatDate(date) {
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }
    </script>
</body>
</html>